<UserControl x:Class="Naviguard.Views.menuNaviguardPages"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:Naviguard.Converters"             
             xmlns:cefSharp="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"             
             xmlns:local="clr-namespace:Naviguard.Views"
             xmlns:vm="clr-namespace:Naviguard.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.DataContext>
        <vm:MenuNaviguardViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <DataTemplate DataType="{x:Type vm:BrowserViewModel}">
            <local:BrowserView/>
        </DataTemplate>

        <converters:SizeToRectConverter x:Key="SizeToRectConverter"/>
        <Color x:Key="BackgroundColorStart">#F5F7FA</Color>
        <Color x:Key="BackgroundColorEnd">#E6E9ED</Color>
        <SolidColorBrush x:Key="IconColor" Color="White"/>
        <SolidColorBrush x:Key="TopBarBackgroundBrush" Color="#D9191C20"/>
        <SolidColorBrush x:Key="ButtonHoverBrush" Color="#3FFFFFFF"/>
        <DropShadowEffect x:Key="ShadowEffect" Color="#000000" Direction="270" ShadowDepth="2" BlurRadius="10" Opacity="0.15"/>
        <PathGeometry x:Key="BrowserIcon">M12,2 C6.48,2 2,6.48 2,12 C2,17.52 6.48,22 12,22 C17.52,22 22,17.52 22,12 C22,6.48 17.52,2 12,2 Z M10,16.5 V7.5 L16,12 L10,16.5 Z</PathGeometry>

        <Storyboard x:Key="HideTopMenuStoryboard">
            <DoubleAnimation Storyboard.TargetName="MenuContainerGrid" Storyboard.TargetProperty="Height" To="30" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="TopMenu" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="MenuHandle" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0:0:0.3" Value="{x:Static Visibility.Visible}"/>
            </ObjectAnimationUsingKeyFrames>
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TopMenu" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0:0:0.3" Value="{x:Static Visibility.Collapsed}"/>
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="ShowTopMenuStoryboard">
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="TopMenu" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
            </ObjectAnimationUsingKeyFrames>
            <DoubleAnimation Storyboard.TargetName="MenuContainerGrid" Storyboard.TargetProperty="Height" To="60" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="TopMenu" Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.2" BeginTime="0:0:0.1"/>
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="MenuHandle" Storyboard.TargetProperty="Visibility">
                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Collapsed}"/>
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <Border x:Name="MainBorder" SnapsToDevicePixels="True" >
        <Border.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="{StaticResource BackgroundColorStart}" Offset="0.0" />
                <GradientStop Color="{StaticResource BackgroundColorEnd}" Offset="1.0" />
            </LinearGradientBrush>
        </Border.Background>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid x:Name="MenuContainerGrid" Grid.Column="1" VerticalAlignment="Top" Height="60">
                    <Border x:Name="TopMenu" Background="{StaticResource TopBarBackgroundBrush}"  CornerRadius="21" Height="42" Margin="0,10,0,0" VerticalAlignment="Top" Effect="{StaticResource ShadowEffect}" Panel.ZIndex="99">

                        <ItemsControl ItemsSource="{Binding Paginas}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" PreviewMouseLeftButtonDown="TopMenu_PreviewMouseLeftButtonDown"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button ToolTip="{Binding NombrePagina}"
                                            Command="{Binding DataContext.NavigateCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource ModernIconButtonStyle}" 
                                            Margin="10,0,0,0">
                                        <Path Data="{StaticResource BrowserIcon}" Fill="{StaticResource IconColor}" Width="20" Height="20" Stretch="Uniform"/>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                    </Border>
                    <Border x:Name="MenuHandle" Background="#AAAAAA" Width="100" Height="8" CornerRadius="4" HorizontalAlignment="Center" VerticalAlignment="Center" Cursor="Hand" Visibility="Collapsed" MouseLeftButtonDown="MenuHandle_MouseLeftButtonDown" ToolTip="Mostrar menú"/>
                </Grid>
            </Grid>

            <Border x:Name="MainContentArea" Grid.Row="1" Background="#FFFFFF" Margin="20,0,20,20" CornerRadius="15" Effect="{DynamicResource ShadowEffect}">
                <Border.Clip>
                    <RectangleGeometry RadiusX="15" RadiusY="15">
                        <RectangleGeometry.Rect>
                            <MultiBinding Converter="{StaticResource SizeToRectConverter}">
                                <Binding ElementName="MainContentArea" Path="ActualWidth"/>
                                <Binding ElementName="MainContentArea" Path="ActualHeight"/>
                            </MultiBinding>
                        </RectangleGeometry.Rect>
                    </RectangleGeometry>
                </Border.Clip>
                <ContentControl Content="{Binding CurrentContentViewModel}"/>
            </Border>
        </Grid>
    </Border>
</UserControl>
